<?php
/*
 * Ingelogd als: erwin@burorader.com
 * Besteld: erwinderksen.com hosting + domein
 */
$varsJson1 = '{"source":"autogen","user":"system","invoiceid":1,"status":"Unpaid"}';
// http://whmcs-acumulus.loc/viewinvoice.php?id=1
// http://whmcs-acumulus.loc/modules/addons/acumulus_connect/test/Factuur-WHA20221.pdf
/*
 * Blijkbaar ging er iets fout want het proces werd opnieuw uitgevoerd en er
 * zijn nu 2 onbetaalde facturen.
 * Ingelogd als: erwin@burorader.com
 * Besteld: erwinderksen.com hosting + domein
 */
$varsJson2 = '{"source":"autogen","user":"system","invoiceid":2,"status":"Unpaid"}';
// http://whmcs-acumulus.loc/viewinvoice.php?id=2
// http://whmcs-acumulus.loc/modules/addons/acumulus_connect/test/Factuur-WHA20222.pdf
$varsJson3 = '{"source":"autogen","user":"system","invoiceid":2}';

$config = <<<'EOS'
{"name":"Acumulus",
"description":"The Acumulus module connects to the Acumulus online financial administration application.",
"version":"3.3",
"author":"SIEL",
"language":"english",
"fields":{"acumulus_code":{"FriendlyName":"Contract code",
"Type":"text",
"Size":"25",
"Description":"Enter the Acumulus contract code here.",
"Default":""},"acumulus_username":{"FriendlyName":"Username",
"Type":"text",
"Size":"25",
"Description":"Enter the Acumulus username here.",
"Default":""},"acumulus_password":{"FriendlyName":"Password",
"Type":"password",
"Size":"25",
"Description":"Enter the Acumulus password here."},"acumulus_credentials_check":{"FriendlyName":"Credential check",
"Description":"Credentials are correct."},"acumulus_features_hook_invoice_message1":{"FriendlyName":"",
"Description":"<h2 style='padding-top:3em;font-weight:bold;font-size:larger'>Features<\/h2>"},"acumulus_emailaspdf":{"FriendlyName":"Let Acumulus send invoice",
"Type":"yesno",
"Size":"25",
"Description":"When enabled imported invoices will be sent as pdf file using Acumulus.<br><i>* When importing invoices with the bulk import, this setting is ignored and no invoices will be sent by Acumulus.<\/i>",
"Default":"no"},"acumulus_customer_import_enabled":{"FriendlyName":"Import customer details",
"Type":"yesno",
"Size":"25",
"Description":"Import WHMCS customer details in Acumulus when an invoice is send to Acumulus.",
"Default":"on"},"acumulus_hook_invoice_create_enabled":{"FriendlyName":"Enable create hook",
"Type":"yesno",
"Size":"25",
"Description":"Send Invoice to Acumulus directly when a new invoice has been generated by the cron, order process, API, when converting a quote to an invoice, or when published a draft invoice with email.",
"Default":"on"},"acumulus_hook_invoice_paid_enabled":{"FriendlyName":"Enable paid hook",
"Type":"yesno",
"Size":"25",
"Description":"Update or Create Invoice in Acumulus directly when paid for.",
"Default":"on"},"acumulus_hook_invoice_canceled_enabled":{"FriendlyName":"Enable Canceled invoice hook",
"Type":"yesno",
"Size":"25",
"Description":"Create Credit invoice in Acumulus when a invoice is being canceled.",
"Default":"on"},"acumulus_customer_message1":{"FriendlyName":"",
"Description":"<h2 style='padding-top:3em;font-weight:bold;font-size:larger'>Customer Settings<\/h2>"},"acumulus_customer_type":{"FriendlyName":"Customer Type",
"Type":"dropdown",
"Options":"Debtor,Creditor,Debtor\/Creditor (neutral)",
"Description":"Select under what type the customer needs to be registered in Acumulus.",
"Default":"Debtor\/Creditor (neutral)"},"acumulus_customer_countryautoname":{"FriendlyName":"Customer country",
"Type":"dropdown",
"Options":"Use the same country as the customer in WHMCS,Automatic prefill based on country code,Automatic prefill based on country code including Nederland",
"Description":"Select which customer country setting needs to be used in Acumulus.",
"Default":"Use the same country as the customer in WHMCS"},"acumulus_customer_overwriteifexists":{"FriendlyName":"Overwrite customer details",
"Type":"yesno",
"Size":"25",
"Description":"Overwrite customer contact details in Acumulus.",
"Default":"on"},"acumulus_customer_disableduplicates":{"FriendlyName":"Disable customer duplicates",
"Type":"yesno",
"Size":"25",
"Description":"Disable older instances of a contact in Acumulus when multiple contacts match the customer email."},"acumulus_whmcs_vatfield":{"FriendlyName":"TAX or VAT field",
"Type":"dropdown",
"Options":",[VAT Number]",
"Description":"WHMCS Vat field or Custom client field that represents the TAX ID or VAT number. The option [VAT Number] is the new vat field since WHMCS 7.7",
"Default":"[VAT Number]"},"acumulus_whmcs_ibanfield":{"FriendlyName":"IBAN field",
"Type":"dropdown",
"Options":"",
"Description":"Custom client field that represents the clients IBAN number.",
"Default":""},"acumulus_cusromer_mark":{"FriendlyName":"Client Mark",
"Type":"text",
"Size":"40",
"Description":"Extra label or mark. <i>(See manual for variables that can be used.)<\/i>",
"Default":"WHMCS Klantnr: {USERID}"},"acumulus_invoice_message1":{"FriendlyName":"",
"Description":"<h2 style='padding-top:3em;font-weight:bold;font-size:larger'>Standard Invoice Settings<\/h2>"},"acumulus_invoice_default_costcenter":{"FriendlyName":"Default Costcenter",
"Type":"dropdown",
"Options":"48663 Algemeen,56074 kostenplaats 1,56075 kostenplaats 2",
"Description":"The default costcenter the new invoices will be booked to.",
"Default":""},"acumulus_invoice_default_nature":{"FriendlyName":"Default nature",
"Type":"dropdown",
"Options":"Product,Service",
"Description":"The default Nature on wich an invoice line is booked.",
"Default":"Service"},"acumulus_use_acumulus_invoice_numbering":{"FriendlyName":"Use Acumulus invoice numbering",
"Type":"yesno",
"Size":"25",
"Description":"When enabled, WHMCS ignors the invoice number and uses Acumulus sequential invoice numbering.<br>",
"Default":"on"},"acumulus_invoice_description":{"FriendlyName":"Invoice title",
"Type":"text",
"Size":"40",
"Description":"Overall description of the invoice, invoice title.<br><i>(See manual for varibles that can be used.)<\/i>",
"Default":"WHMCS Factuur: {INVOICENUMBER}"},"acumulus_creditinvoice_description":{"FriendlyName":"Credit Invoice title",
"Type":"text",
"Size":"40",
"Description":"Overall description for the Credit invoice, credit invoice title.<br><i>(See manual for varibles that can be used.)<\/i>",
"Default":"Credit Factuur:  WHMCS: {INVOICENUMBER}"},"acumulus_invoice_descriptiontext":{"FriendlyName":"Invoice extended description",
"Type":"textarea",
"Rows":"4",
"Cols":"47",
"Description":"Multiline field for extended description of the invoice. Content will appear on invoice and associated emails.<br><i>(See manual for varibles that can be used.) note: tabs cannot be used here<\/i>",
"Default":"{INVOICENOTES}"},"acumulus_invoice_invoicenotes":{"FriendlyName":"Invoice additional remarks",
"Type":"textarea",
"Rows":"4",
"Cols":"47",
"Description":"Multiline field for additional remarks.  Contents is placed in notes\/comments section of the invoice. Content <b>will not appear<\/b> on the actual invoice or associated emails.<br><i>(See manual for varibles that can be used.) (Use {TAB} for tabs)<\/i>",
"Default":""},"acumulus_invoice_template":{"FriendlyName":"Invoice Template",
"Type":"dropdown",
"Options":",39851 Standaard,52884 sjabloon 2",
"Description":"Name of the template that will be used by Acumulus. When omitted, the first available template in the contract will be selected.",
"Default":""},"acumulus_invoice_message2":{"FriendlyName":"",
"Description":"<h2 style='padding-top:3em;font-weight:bold;font-size:larger'>Additional Invoice Settings<\/h2>"},"acumulus_summarize_invoice":{"FriendlyName":"Summarize invoice lines",
"Type":"yesno",
"Size":"25",
"Description":"Combine all invoice lines to one total invoice line. <i>The field \"Invoice line description\" is used as the description on the invoice line.<\/i>",
"Default":""},"acumulus_invoice_correction":{"FriendlyName":"Invoice Correction",
"Type":"yesno",
"Size":"25",
"Description":"When enabled, the module will try to estimate the totals (WHMCS and ACUMULUS) and add a correction line when needed.",
"Default":""},"acumulus_invoice_use_last_paymentmethod":{"FriendlyName":"Use last payment method",
"Type":"yesno",
"Size":"25",
"Description":"When enabled, the module will change the account numbers invoice in Acumulus to use the last payment method.",
"Default":"on"},"acumulus_accountnumber_message1":{"FriendlyName":"",
"Description":"<h2 style='padding-top:3em;font-weight:bold;font-size:larger'>Account number translation<\/h2>"},"acumulus_AccountNumber_banktransfer":{"FriendlyName":"WHMCS Payment Gateway: <b>Bank Transfer<\/b>",
"Type":"dropdown",
"Options":"70582 4911764 (Giro),70583 Kas,147659 123456789,199562 FR1234567890,-1 Account not part of Acumulus",
"Description":"Select the matching Acumulus AccountNumber.",
"Default":""},"acumulus_AccountNumber_paypal":{"FriendlyName":"WHMCS Payment Gateway: <b>PayPal Basic<\/b>",
"Type":"dropdown",
"Options":"70582 4911764 (Giro),70583 Kas,147659 123456789,199562 FR1234567890,-1 Account not part of Acumulus",
"Description":"Select the matching Acumulus AccountNumber.",
"Default":""},"acumulus_AccountNumber_mailin":{"FriendlyName":"WHMCS Payment Gateway: <b>Mail In Payment<\/b>",
"Type":"dropdown",
"Options":"70582 4911764 (Giro),70583 Kas,147659 123456789,199562 FR1234567890,-1 Account not part of Acumulus",
"Description":"Select the matching Acumulus AccountNumber.",
"Default":""},"acumulus_warning_message2":{"FriendlyName":"",
"Description":"<h2 style='padding-top:3em;font-weight:bold;font-size:larger'>Warnings & Errors<\/h2>"},"acumulus_warning_email_address":{"FriendlyName":"Email address for warnings",
"Type":"text",
"Size":"25",
"Description":"Enter an email address where api warning messages should be send to.<br> When omitted no warnings will be sent.",
"Default":""},"acumulus_error_email_address":{"FriendlyName":"Email address for errors",
"Type":"text",
"Size":"25",
"Description":"Enter an email address where api error messages should be sent to.<br>When omitted no errors will be sent.",
"Default":""},"acumulus_api_message1":{"FriendlyName":"",
"Description":"<h2 style='padding-top:3em;font-weight:bold;font-size:larger'>WHMCS API Settings<\/h2>"}}}
EOS;

$invoice = <<<'EOS'
{"result":"success",
"invoiceid":1,"invoicenum":"TMP1",
"userid":1,"date":"2022-01-14",
"duedate":"2022-01-14",
"datepaid":"0000-00-00 00:00:00",
"lastcaptureattempt":"0000-00-00 00:00:00",
"subtotal":"74.95",
"credit":"0.00",
"tax":"14.99",
"tax2":"0.00",
"total":"89.94",
"balance":"0.00",
"taxrate":"20.000",
"taxrate2":"0.000",
"status":"Cancelled",
"paymentmethod":"banktransfer",
"notes":"",
"ccgateway":false,"items":{"item":[
{"id":1,"type":"Hosting",
"relid":1,"description":"Hosting - erwinderksen.com (14\/01\/2022 - 13\/01\/2023)",
"amount":"60.00",
"taxed":1,"custom_tax_unrounded":10,"custom_tax_rounded":10,"custom_price_incl_tax_unrounded":60,"custom_price_incl_tax_rounded":60,"custom_price_excl_tax_unrounded":50,"custom_price_excl_tax_rounded":50},{"id":2,"type":"DomainRegister",
"relid":1,"description":"Domein registratie - erwinderksen.com - 1 Jaar (14\/01\/2022 - 13\/01\/2023)",
"amount":"14.95",
"taxed":1,"custom_tax_unrounded":2.4917,"custom_tax_rounded":2.49,"custom_price_incl_tax_unrounded":14.95,"custom_price_incl_tax_rounded":14.95,"custom_price_excl_tax_unrounded":12.4583,"custom_price_excl_tax_rounded":12.46}[
},"transactions":{"transaction":[
{"id":1,"userid":1,"currency":0,"gateway":"banktransfer",
"date":"2022-01-15 09:37:59",
"description":"Invoice Payment",
"amountin":"89.94",
"fees":"0.00",
"amountout":"0.00",
"rate":"1.00000",
"transid":"",
"invoiceid":1,"refundid":0}[
},"custom":{"subtotal_taxedItems_exclTax":62.4583,"subtotal_taxedItems_inclTax":74.95,"subtotal_untaxedItems":0,"total_tax_roundedPerItem":12.49,"total_tax":12.4917,"vattype":"6",
"taxrate":"20.000",
"subamountTaxRounded":0}}
EOS;
